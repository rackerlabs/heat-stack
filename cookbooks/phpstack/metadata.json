{"name":"phpstack","description":"Provides a full php stack","long_description":"# phpstack Cookbook\n-------------------------------\n\nSupported Platforms\n-------------------\n* CentOS 6.5\n* Ubuntu 12.04\n\nRequirements\n------------\n#### Cookbooks\n\n* `git`\n* `rackops_rolebook`  \n* `yum`  \n* `yum-epel`  \n* `yum-ius`\n* `apt`  \n* `php`  \n* `php::ini`  \n* `php::module_mysql`  \n* `chef-sugar`  \n* `platformstack::monitors`  \n* `platformstack::iptables`  \n* `apache2`  \n* `apache2::mod_php5`  \n* `database::mysql`  \n* `mysql:server`  \n* `mysql-multi`\n* `pg-multi`  \n* `java`  \n* `varnish`  \n* `rabbitmq`  \n* `varnish`\n\nRecipes\n----------\n#### default\n#### apache\nIncludes recipes: platformstack::monitors platformstack::iptables apt apache2::default apache2::mod_php5\nCreates sites coming from node['apache']['sites'] array\nCreates monitoring check for each site if node[platformstack][cloud_monitoring] = enabled\n#### application_php\nIncludes recipes: git, yum, yum-epel, yum-ius, apt, php, php::ini, php::module_mysql, phpstack::apache, phpstack::php_fpm, chef-sugar\nIf gluster is part of the environment attributes, installs the utils and mount it to /var/www (the default of node['apache']['docroot_dir'] on debian/ubuntu)\nCreates application_deployment configuration, checking out the code from node['apache']['sites']['repository'] and putting into the path specified in node['apache']['sites']['docroot']\nCreates a configuration file for applications using variables for mysql_master node and rabbitmq node and placing this file in /etc/phpstack.ini\n#### gluster\nIncludes recipe chef-sugar\nGets the number of nodes to be part of the cluster\nCreates rules to add to iptables web nodes access to gluster\nInstalls rackspace_gluster cookbook\n#### memcache\nInstalls memcached\n#### mongodb_standalone\nInstalls mongodb:10gen_repo\nInstalls mongodb::default\n#### mysql_add_drive\nFormats /dev/xvde1 and will prepare it for the mysql datadir.\nCreates mysql user\nCreates /var/lib/mysql directory\nMounts /dev/xvde1 on /var/lib/mysql\n#### mysql_base\nIncludes recipe database::mysql, platformstack::monitors, mysql::server, mysql-multi::mysql_base\nSet mysql passwords dynamically\nAdds mysql holland user if node[holland] = enabled\nAdds mysql monitoring user\nCreates mysql-monitor template if node[platformstack][cloud_monitoring] = enabled\nCreates an iptables rule for application_php nodes in order to connect to this one.\n#### mysql_holland\nSetup an apt or yum repository for holland\nInstalls needed packages (holland and holland-mysqldump)\nVerifies if this server is a slave or standalone\nSetup a cronjob based on holland attributes\n#### mysql_master\nIncludes recipe phpstack::mysql_base, mysql-multi::mysql_master, chef-sugar\nCreates mysql-monitor template if node[platformstack][cloud_monitoring] = enabled\nCreates an user with select, update and insert permissions, for each server that matches application_php recipe within the specified environment using site_name as username and node['apache']['sites'][site_name]['mysql_password'] for password.\nCan configure multiple databases and users with passwords from node['apache']['sites'][site]['databases'] array\n#### mysql_slave\nIncludes recipe phpstack::mysql_base and mysql-multi::mysql_slave\n#### php_fpm\nIncludes recipe php_fpm\n#### postgresql_base\nCreates base postgresql server in standalone mode\n#### postgresql_master\nCreates postgresql server in master node configuration\n#### postgresql_slave\nCreates posgresql server in slave node configuration\n#### rabbitmq\nIncludes recipe platformstack::iptables\nCreates an iptables rule for application_php nodes in order to connect to this one.\nDisables the default user\nCreates the rabbit vhost\nSet random App Passwords\nAdd the queue per site defined in node['apache']['sites'] array\n#### redis\nIncludes recipe redisio\nInstalls redis-server using attributes\n#### varnish\nInstalls varnish recipe\n#### yum\nIncludes recipe yum\nInstalls yum-epel and IUS repository\n\n\n\nData_Bag\n----------\n\nNo Data_Bag configured for this cookbook\n\n\nAttributes\n----------\n\n#### apache.rb\n* site1 = 'example.com'\n  * Indicate the fqdn of the site number 1\n* node.default['apache']['sites'][site1]['port']         = 80\n  * Indicates what port should be this site listening on\n* node.default['apache']['sites'][site1]['cookbook']     = 'phpstack'\n  * Indicates the name of the cookbook to get templates from\n* node.default['apache']['sites'][site1]['template']     = \"apache2/sites/#{site1}.erb\"\n  * Indicates template file location for this site\n* node.default['apache']['sites'][site1]['server_name']  = site1\n  * Indicates server_name variable to be used in template file\n* node.default['apache']['sites'][site1]['server_alias'] = [\"test.#{site1}\", \"www.#{site1}\"]\n  * Indicates server_alias variable to be used in template file\n* node.default['apache']['sites'][site1]['docroot']      = \"/var/www/#{site1}\"\n  * Indicates docroot variable to be used in template file\n* node.default['apache']['sites'][site1]['allow_override'] = ['All']\n  * Indicates allow_override variable to be used in template file\n* node.default['apache']['sites'][site1]['errorlog']     = \"#{node['apache']['log_dir']}/#{site1}-error.log\"\n  * Indicates errorlog variable to be used in template file\n* node.default['apache']['sites'][site1]['customlog']    = \"#{node['apache']['log_dir']}/#{site1}-access.log combined\"\n  * Indicates customlog variable to be used in template file\n* node.default['apache']['sites'][site1]['loglevel']     = 'warn'\n  * Indicates loglevel variable to be used in template file\n* node.default['apache']['sites'][site1]['server_admin'] = 'demo@demo.com'\n  * Indicates server_admin variable to be used in template file\n* node.default['apache']['sites'][site1]['revision'] = \"v#{version1}\"\n  * Indicates revision variable to be used to deploy this site files\n* node.default['apache']['sites'][site1]['repository'] = 'https://github.com/rackops/php-test-app'\n  * Indicates repository variable to be used to deploy this site\n* node.default['apache']['sites'][site1]['deploy_key'] = '/root/.ssh/id_rsa'\n  * Indicates deploy_key variable to be used when getting data from repository\n* node.default['apache']['sites'][site1]['databases'][site1]['mysql_user'] = site1\n  * Indicates a database and database user to be configured\n* node.default['apache']['sites'][site1]['databases'][site1]['mysql_password'] = ''\n  * Indicates the password to configure for database user with blank being random\n\n#### gluster.rb\n\n* default['rackspace_gluster']['config']['server']['glusters']['Gluster Cluster 1'] = {}\n* default['rackspace_gluster']['config']['server']['glusters']['Gluster Cluster 1']['volume'] = 'vol0'\n\n#### holland.rb\n\n* default['holland']['enabled'] = false\n  * Defines if holland is enabled or not in this node\n* default['holland']['password'] = 'notagudpassword'\n  * Defines the password for holland user in mysql database\n* default['holland']['cron']['day'] = '*'\n  * Defines day for backup\n* default['holland']['cron']['hour'] = '3'\n  * Defines hour for backup\n* default['holland']['cron']['minute'] = '12'\n  * Defines minute for backup\n\n####Â monitoring.rb\n\n* default['phpstack']['cloud_monitoring']['remote_http']['disabled'] = false\n* default['phpstack']['cloud_monitoring']['remote_http']['alarm'] = false\n* default['phpstack']['cloud_monitoring']['remote_http']['period'] = 60\n* default['phpstack']['cloud_monitoring']['remote_http']['timeout'] = 15\n* default['phpstack']['cloud_monitoring']['agent_mysql']['disabled'] = false\n* default['phpstack']['cloud_monitoring']['agent_mysql']['alarm'] = false\n* default['phpstack']['cloud_monitoring']['agent_mysql']['period'] = 60\n* default['phpstack']['cloud_monitoring']['agent_mysql']['timeout'] = 15\n* default['phpstack']['cloud_monitoring']['agent_mysql']['user'] = 'raxmon-agent'\n* default['phpstack']['cloud_monitoring']['agent_mysql']['password'] = nil\n\n#### mysql.rb\n\n* default['mysql-multi']['master'] = ''\n* default['mysql-multi']['slaves'] = []\n* default['mysql-multi']['slave_user'] = 'replicant'\n\n#### php.rb\n\n* default['php']['packages'] = []\n  * List of packages needed based on platform_family\n* default['phpstack']['ini']['cookbook'] = 'phpstack'\n  * Indicates the cookbook where to get ini template to override\n\n#### php_fpm.rb\n* default['php-fpm']['pools'] = false\n  * Defines if a pool needs to be created at this time\n* default['php']['package-name'] = []\n  * Installs required packages based on platform_family\n\n#### postgresql.rb\n* default['postgresql']['password']['postgres'] = 'randompasswordforpostgresql'\n  * Indicates admin password for postgresql\n\n#### rabbitmq.rb\n* default['phpstack']['rabbitmq']['passwords'] = {}\n  * Indicates admin password for rabbitmq\n\n\nUsage\n-----\n\n#### phpstack\n\n* single node (app and db)\n\tInclude recipe `platformstack::default`, `rackops_rolebook::default`, `phpstack::mysql_base`, `phpstack::application_php` in your node's `run_list`:\n```json\n{\n  \"run_list\": [\n  \"recipe[platformstack::default]\",\n  \"recipe[rackops_rolebook::default]\",\n  \"recipe[phpstack::mysql_base]\",\n  \"recipe[phpstack::application_php]\"\n  ]\n}\n```\n* single app node - standalone db node\n  DB Node: Include recipe `platformstack::default`, `rackops_rolebook::default`, `phpstack::mysql_base` in your node's `run_list`:\n```json\n{\n  \"run_list\": [\n  \"recipe[platformstack::default]\",\n  \"recipe[rackops_rolebook::default]\",\n  \"recipe[phpstack::mysql_base]\",\n  \"recipe[phpstack::application_php]\"\n  ]\n}\n```\n\n  App Node: Include recipe `platformstack::default`, `rackops_rolebook::default`, `phpstack::application_php` in your node's `run_list`:\n```json\n{\n  \"run_list\": [\n  \"recipe[platformstack::default]\",\n  \"recipe[rackops_rolebook::default]\",\n  \"recipe[phpstack::application_php]\"\n  ]\n}\n```\n* single app node - multi db node\n\nEnsure the following attributes are set within environment or wrapper cookbook.\n\n```\n['mysql']['server_repl_password'] = 'rootlogin'\n['mysql']['server_repl_password'] = 'replicantlogin'\n['mysql-multi']['master'] = '1.2.3.4'\n['mysql-multi']['slaves'] = ['5.6.7.8']\n```\n\nMySQL DB Master Node: Include recipe `platformstack::default`, `rackops_rolebook::default`, `phpstack::mysql_master` in your node's `run_list`:\n```json\n{\n  \"run_list\": [\n  \"recipe[platformstack::default]\",\n  \"recipe[rackops_rolebook::default]\",  \n  \"recipe[phpstack::mysql_master]\"\n  ]\n}\n```\n\nMySQL DB Slave Node: Include recipe `platformstack::default`, `rackops_rolebook::default`, `phpstack::mysql_slave`, `phpstack::mysql_slave` in your node's `run_list`:\n```json\n{\n  \"run_list\": [\n  \"recipe[platformstack::default]\",\n  \"recipe[rackops_rolebook::default]\",\n  \"recipe[phpstack::mysql_slave]\",\n  \"recipe[phpstack::application_php]\"\n  ]\n}\n```\n\nApp Node: Include recipe `platformstack::default`, `rackops_rolebook::default`, `phpstack::application_php` in your node's `run_list`:\n```json\n{\n  \"run_list\": [\n  \"recipe[platformstack::default]\",\n  \"recipe[rackops_rolebook::default]\",\n  \"recipe[phpstack::application_php]\"\n  ]\n}\n```\n\n* Building a PostgreSQL cluster for phpstack.\n\nEnsure the following attributes are set within environment or wrapper cookbook.\n\n```\n['postgresql']['version'] = '9.3'\n['postgresql']['password'] = 'postgresdefault'\n['pg-multi']['replication']['password'] = 'useagudpasswd'\n['pg-multi']['master_ip'] = '1.2.3.4'\n['pg-multi']['slave_ip'] = ['5.6.7.8']\n\nDepending on OS one of the following two must be set:\n['postgresql']['enable_pdgd_yum'] = true  (Redhat Family)\n['postgresql']['enable_pdgd_apt'] = true  (Debian Family)\n```\n\nMaster Postgresql node:\n```json\n{\n  \"run_list\": [\n  \"recipe[platformstack::default]\",\n  \"recipe[rackops_rolebook::default]\",\n  \"recipe[phpstack::postgresql_master]\"\n  ]\n}\n```\nSlave node:\n```json\n{\n  \"run_list\": [\n  \"recipe[platformstack::default]\",\n  \"recipe[rackops_rolebook::default]\",\n  \"recipe[phpstack::postgresql_slave]\"\n  ]\n}\n```\n\nNew Relic Monitoring\n--------------------\n\nTo configure New Relic, make sure the `node['newrelic']['license']`\nattribute is set and include the `platformstack` cookbook in your run_list.\n\nNew Relic monitoring plugins can be configured by including the `newrelic::meetme-plugin`\nrecipe in your run_list and setting the following attribute hash in an application\ncookbook:\n\n```ruby\nnode.override['newrelic']['meetme-plugin']['services'] = {\n  \"memcached\": {\n    \"name\": \"localhost\",\n    \"host\":  \"host\",\n    \"port\":  11211\n  }\n}\n```\n\nMore examples can be found [here](https://github.com/escapestudios-cookbooks/newrelic#meetme-pluginrb)\nand [here](https://github.com/MeetMe/newrelic-plugin-agent#configuration-example).\n\nContributing\n------------\n\nhttps://github.com/rackspace-cookbooks/contributing/blob/master/CONTRIBUTING.md\n\n\nAuthors\n-------\nAuthors:: Rackspace DevOps (devops@rackspace.com)\n","maintainer":"Rackspace UK, Ltd.","maintainer_email":"rackspace-cookbooks@rackspace.com","license":"Apache 2.0","platforms":{},"dependencies":{"apache2":">= 0.0.0","application":">= 0.0.0","application_php":">= 0.0.0","apt":">= 0.0.0","build-essential":">= 0.0.0","chef-sugar":">= 0.0.0","database":">= 0.0.0","git":">= 0.0.0","memcached":">= 0.0.0","mongodb":">= 0.0.0","mysql":">= 0.0.0","mysql-multi":">= 0.0.0","newrelic":">= 0.0.0","newrelic_meetme_plugin":">= 0.0.0","nginx":">= 0.0.0","openssl":">= 0.0.0","pg-multi":">= 0.0.0","php":">= 0.0.0","php-fpm":">= 0.0.0","platformstack":">= 0.0.0","rabbitmq":">= 0.0.0","rackspace_gluster":">= 0.0.0","redis-multi":">= 0.0.0","varnish":">= 0.0.0","yum":">= 0.0.0","yum-ius":">= 0.0.0","yum-epel":">= 0.0.0"},"recommendations":{},"suggestions":{},"conflicting":{},"providing":{},"replacing":{},"attributes":{},"groupings":{},"recipes":{},"version":"1.2.2"}